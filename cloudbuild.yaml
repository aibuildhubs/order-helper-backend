substitutions:
  _SERVICE: "order-helper-backend-demo"   # αλλάζει από trigger
  _REGION: "europe-west1"                 # αλλάζει από trigger
  _SERVICE_ACCOUNT: "cloudrun-exec-demo@mail-order-helper-enterprise.iam.gserviceaccount.com"  # αλλάζει από trigger
  _IMAGE: "order-helper-backend-demo"     # αλλάζει από trigger

steps:
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build','-t','gcr.io/$PROJECT_ID/${_IMAGE}:$COMMIT_SHA','.']

  - name: 'gcr.io/cloud-builders/docker'
    args: ['push','gcr.io/$PROJECT_ID/${_IMAGE}:$COMMIT_SHA']

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: gcloud
    args:
      [
        'run','deploy','${_SERVICE}',
        '--image=gcr.io/$PROJECT_ID/${_IMAGE}:$COMMIT_SHA',
        '--region','${_REGION}',
        '--allow-unauthenticated',
        '--service-account','${_SERVICE_ACCOUNT}'
      ]

images:
  - 'gcr.io/$PROJECT_ID/${_IMAGE}:$COMMIT_SHA'
